(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{8552:function(e,t,r){Promise.resolve().then(r.t.bind(r,9974,23)),Promise.resolve().then(r.bind(r,5571)),Promise.resolve().then(r.t.bind(r,2778,23)),Promise.resolve().then(r.t.bind(r,2648,23)),Promise.resolve().then(r.bind(r,8996)),Promise.resolve().then(r.bind(r,1245))},8996:function(e,t,r){"use strict";r.d(t,{default:function(){return d}});var a=r(7437),s=r(2265),n=r(7648),l=r(9376);function o(e){let{className:t="",placeholder:r="搜索文章...",initialValue:n="",onSearch:o,autoFocus:i=!1}=e,d=(0,l.useRouter)(),[c,u]=(0,s.useState)(n),h=(0,s.useRef)(null);(0,s.useEffect)(()=>{u(n)},[n]),(0,s.useEffect)(()=>{i&&h.current&&h.current.focus()},[i]);let x=e=>{u(e),o&&e.trim().length>=2&&o(e)};return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=c.trim();t&&(o?o(t):d.push("/search?q=".concat(encodeURIComponent(t))))},className:"relative flex items-center ".concat(t),children:[(0,a.jsx)("input",{ref:h,type:"text",value:c,onChange:e=>x(e.target.value),placeholder:r,className:"w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{type:"submit",className:"absolute right-2 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"搜索",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})})}),c&&(0,a.jsx)("button",{type:"button",onClick:()=>u(""),className:"absolute right-9 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"清除搜索",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}var i=r(1245);function d(){let e=(0,l.usePathname)(),[t,r]=(0,s.useState)(!1),d=(0,s.useRef)(null),[c,u]=(0,s.useState)(!1),{user:h,logout:x}=(0,i.a)();(0,s.useEffect)(()=>{r(!1)},[e]),(0,s.useEffect)(()=>{function e(e){d.current&&!d.current.contains(e.target)&&r(!1)}return t&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[t]);let m=[{href:"/",label:"首页"},{href:"/blog",label:"博客"},{href:"/tags",label:"标签"},{href:"/changelog",label:"更新日志"},{href:"/about",label:"关于"}],f=h?[{href:"/profile",label:"个人资料",show:!0},{href:"/profile/bookmarks",label:"我的收藏",show:!0},{href:"/admin/posts",label:"文章管理",show:"admin"===h.role},{href:"/admin/changelog",label:"更新日志",show:"admin"===h.role},{href:"#",label:"登出",onClick:()=>x(),show:!0}]:[{href:"/auth/login",label:"登录",show:!0},{href:"/auth/register",label:"注册",show:!0}];return(0,a.jsxs)("nav",{className:"bg-white dark:bg-gray-900 shadow-sm sticky top-0 z-50",children:[(0,a.jsx)("div",{className:"container mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsxs)(n.default,{href:"/",className:"text-xl font-bold text-gray-900 dark:text-white flex items-center",children:[(0,a.jsx)("span",{className:"text-blue-600 mr-1",children:"✍️"})," 个人博客"]}),(0,a.jsxs)("div",{className:"hidden md:flex items-center space-x-6",children:[(0,a.jsx)("div",{className:"flex space-x-4",children:m.map(t=>(0,a.jsx)(n.default,{href:t.href,className:"px-2 py-1 rounded-md text-sm font-medium transition-colors duration-200 ".concat(e===t.href?"text-blue-600 dark:text-blue-400":"text-gray-700 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400"),children:t.label},t.href))}),(0,a.jsx)(o,{className:"w-64"}),(0,a.jsx)("div",{className:"flex space-x-4",children:h?(0,a.jsxs)("div",{className:"relative ml-3",children:[(0,a.jsxs)("button",{onClick:()=>u(!c),className:"flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",id:"user-menu","aria-expanded":"false","aria-haspopup":"true",children:[(0,a.jsx)("span",{className:"sr-only",children:"打开用户菜单"}),(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white",children:h.name?h.name.charAt(0).toUpperCase():"U"})]}),c&&(0,a.jsx)("div",{className:"origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none",role:"menu","aria-orientation":"vertical","aria-labelledby":"user-menu",children:f.map((e,t)=>e.show&&(0,a.jsx)(n.default,{href:e.href,onClick:()=>{e.onClick&&e.onClick(),u(!1)},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",role:"menuitem",children:e.label},e.href+t))})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.default,{href:"/auth/login",className:"px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-100 transition-colors duration-200",children:"登录"}),(0,a.jsx)(n.default,{href:"/auth/register",className:"px-3 py-1.5 rounded-md text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200",children:"注册"})]})})]}),(0,a.jsx)("div",{className:"md:hidden flex items-center",children:(0,a.jsxs)("button",{onClick:()=>r(!t),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-blue-600 hover:bg-gray-100 transition-colors duration-200 dark:text-gray-300 dark:hover:text-white","aria-expanded":t,children:[(0,a.jsx)("span",{className:"sr-only",children:"打开菜单"}),t?(0,a.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,a.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]})})]})}),(0,a.jsx)("div",{ref:d,className:"md:hidden fixed inset-y-0 right-0 w-64 bg-white dark:bg-gray-900 shadow-lg transform transition-transform duration-300 ease-in-out z-50 ".concat(t?"translate-x-0":"translate-x-full"),children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"菜单"}),(0,a.jsx)("button",{onClick:()=>r(!1),className:"rounded-md p-2 text-gray-700 hover:text-red-500 dark:text-gray-300",children:(0,a.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"space-y-1",children:m.map(t=>(0,a.jsx)(n.default,{href:t.href,className:"block px-3 py-3 rounded-md text-base font-medium ".concat(e===t.href?"text-blue-600 bg-blue-50 dark:text-blue-400 dark:bg-gray-800":"text-gray-700 hover:text-blue-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:text-blue-400 dark:hover:bg-gray-800"),children:t.label},t.href))}),(0,a.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 space-y-1",children:h?f.map((e,t)=>e.show&&(0,a.jsx)(n.default,{href:e.href,onClick:e.onClick,className:"block px-3 py-3 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:text-blue-400 dark:hover:bg-gray-800",children:e.label},e.href+t)):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.default,{href:"/auth/login",className:"block px-3 py-3 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50",children:"登录"}),(0,a.jsx)(n.default,{href:"/auth/register",className:"block px-3 py-3 rounded-md text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-gray-50",children:"注册"})]})}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(o,{className:"w-full"})})]})}),t&&(0,a.jsx)("div",{className:"md:hidden fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>r(!1)})]})}},1245:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return o},a:function(){return i}});var a=r(7437),s=r(2265),n=r(9376);let l=(0,s.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,s.useState)(null),[i,d]=(0,s.useState)(!0),[c,u]=(0,s.useState)(null),h=(0,n.useRouter)();(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();o(t.user)}}catch(e){console.error("认证检查失败:",e)}finally{d(!1)}})()},[]);let x=async(e,t)=>{o(e);let r=new CustomEvent("auth:login",{detail:{user:e}});window.dispatchEvent(r)},m=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),o(null);let e=new CustomEvent("auth:logout");window.dispatchEvent(e),h.push("/auth/login")}catch(e){console.error("登出失败:",e)}};return(0,a.jsx)(l.Provider,{value:{user:r,login:x,logout:m,isLoading:i,error:c},children:t})}function i(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth 必须在 AuthProvider 内使用");return e}},2778:function(){}},function(e){e.O(0,[329,972,467,971,117,744],function(){return e(e.s=8552)}),_N_E=e.O()}]);